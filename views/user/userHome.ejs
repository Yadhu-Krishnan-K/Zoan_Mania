<%- include('../layouts/user/header') -%>

  <div class="container-fluid">
    <!-- Carousel -->
    <div id="demo" class="carousel slide" data-bs-ride="carousel">

      <!-- Indicators/dots -->
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#demo" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#demo" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#demo" data-bs-slide-to="2"></button>
      </div>

      <!-- The slideshow/carousel -->
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="pics/Group 1.png" alt="Los Angeles" class="d-block w-100">
          <div class="carousel-caption pos ">
            <p>SUMMER 2024</p>
            <h1 class="text-justify">Multicoloured
              Tie-dye Sweater</h1>
            <p>We had such a great time in LA!</p>
            <a href="#">
              <button class="text-light"
                style="background-color: transparent; border: white solid 1px; padding: 10px 10px;">SHOP NOW</button>
            </a>
          </div>
        </div>
        <div class="carousel-item">
          <img src=" pics/Group 1.png" alt="Chicago" class="d-block w-100">
          <div class="carousel-caption">
            <h3>Los Angeles</h3>
            <p>We had such a great time in LA!</p>
          </div>
        </div>

      </div>

      <!-- Left and right controls/icons -->
      <button class="carousel-control-prev" type="button" data-bs-target="#demo" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#demo" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
      </button>
    </div>



    <div class="row">
      <div class="col-12 d-flex flex-column align-items-center">
        <P class="mt-5">Featured Products</P>
        <h3 class="mb-5">BESTSELLER PRODUCTS</h3>
      </div>
    </div>

    <div class="row">
      <% productModel.forEach(product=> { %>
        <% if (product.Image.length !==0) { %>
          <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
            <div class="card h-100 shadow-sm p-2">
              <a href="/productDetail/<%= product._id %>">
                <img class="card-img-top img-fluid" src="/uploads/<%= product.Image[0] %>"
                  style=" height: 220px; object-fit: contain; border-radius: 0.5rem;" alt="<%= product.Name %>">
              </a>
              <div class="card-body text-center d-flex flex-column justify-content-between">
                <div>
                  <h6 class="card-title">
                    <%= product.Name %>
                  </h6>
                  <% if (product.Stock>= 1) { %>
                    <p class="card-text fw-bold">â‚¹<%= product.Price %>/-</p>
                    <% } else { %>
                      <p class="card-text fw-bold text-danger">Out of stock</p>
                      <% } %>
                </div>

                <div>
                  <% let isInCart=false; %>
                  <% if (locals.cartData && cartData.Items.length> 0) { %>
                    <% for (let index=0; index < cartData.Items.length; index++) { %>
                      <% if (String(product._id)===String(cartData.Items[index].ProductId._id)) { %>
                        <% isInCart=true; break; %>
                      <% } %>
                    <% } %>
                  <% } %>

                  <% if (product.Stock < 1) { %>
                    <button class="btn btn-warning" disabled>Out of Stock</button>
                  <% } else if (isInCart) { %>
                    <a href="/cart" class="btn btn-warning">Go To Cart</a>
                  <% } else if(!locals.name){ %>
                    <a class="btn btn-success" href="/login">
                        Add To Cart
                    </a>
                  <% }else { %>
                    <button class="btn btn-success" onclick="addToCart('<%= product._id %>')">
                        Add To Cart
                    </button>
                  <% } %>
                </div>
              </div>
            </div>
          </div>
          <% } %>
            <% }) %>
    </div>

  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    
    window.onload = function(){
      const userId = "<%= userId %>";
  
      if(!userId){
        return
      }
      console.log('userId present, userId = ',userId)
  
      const socket = io();
      socket.emit('register user',userId)
    }


    function addToCart(P_id) {
      $(document).ready(function () {
        fetch(`/addToCart/${P_id}`)
          .then(res => res.json())
          .then((data) => {
            console.log("dat======", data)
            if (data.success) {
              //add sweet alert
              Swal.fire({
                position: "top",
                icon: "success",
                title: "one item add to cart",
                showConfirmButton: false,
                timer: 1500
              });
              location.reload()
            }
          })
      })
    }

  </script>
  <%- include('../layouts/user/footer') -%>