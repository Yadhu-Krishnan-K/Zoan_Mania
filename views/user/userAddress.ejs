<%- include('../layouts/user/header') -%>

<div class="container py-5">
  <div class="row justify-content-center">

    <!-- Address Section -->
    <div class="col-md-9">

      <!-- No Address Found -->
      <% if (userData && Array.isArray(userData.address) && userData.address.length === 0) { %>
        <div class="text-center mt-5">
          <h4 class="text-muted">No address found...</h4>
          <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addAddressModal">
            <i class="fa fa-plus me-2"></i>Add Address
          </button>
        </div>
      <% } else if (userData && Array.isArray(userData.address)) { %>

        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="fw-bold">Your Addresses</h3>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAddressModal">
            <i class="fa fa-plus me-2"></i>Add Address
          </button>
        </div>

        <!-- Address Cards -->
        <div class="row g-4" id="address-list-container">
          <% userData.address.forEach((addr) => { %>
            <div class="col-md-6">
              <div class="card shadow border-0 rounded-3">
                <div class="card-body">
                  <h5 class="card-title mb-3 text-primary"><i class="fa fa-home me-2"></i><%= addr.Name %></h5>
                  <p class="mb-1"><strong>Address:</strong> <%= addr.AddressLine %></p>
                  <p class="mb-1"><strong>City:</strong> <%= addr.City %></p>
                  <p class="mb-1"><strong>State:</strong> <%= addr.State %></p>
                  <p class="mb-1"><strong>Pincode:</strong> <%= addr.Pincode %></p>
                  <p class="mb-3"><strong>Mobile:</strong> <%= addr.Mobile %></p>
                  
                  <div class="d-flex justify-content-end gap-2">
                    <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#EditAddressModal<%= addr._id %>">
                      <i class="fa fa-edit me-1"></i>Edit
                    </button>
                    <a href="/deleteAddress/<%= userData._id %>/<%= addr._id %>" 
                       onclick="return confirm('Do you want to delete this address?')" 
                       class="btn btn-sm btn-danger">
                      <i class="fa fa-trash me-1"></i>Delete
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <!-- Edit Address Modal -->
            <div class="modal fade" id="EditAddressModal<%= addr._id %>" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title fw-bold">Edit Address</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body">
                    <form>
                      <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-control" id="reci-name-<%= addr._id %>" value="<%= addr.Name %>">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Address</label>
                        <textarea class="form-control" id="reci-address-<%= addr._id %>"><%= addr.AddressLine %></textarea>
                      </div>
                      <div class="row">
                        <div class="col-md-6 mb-3">
                          <label class="form-label">City</label>
                          <input type="text" class="form-control" id="reci-City-<%= addr._id %>" value="<%= addr.City %>">
                        </div>
                        <div class="col-md-6 mb-3">
                          <label class="form-label">Pincode</label>
                          <input type="number" class="form-control" id="reci-Pincode-<%= addr._id %>" value="<%= addr.Pincode %>">
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6 mb-3">
                          <label class="form-label">State</label>
                          <input type="text" class="form-control" id="reci-State-<%= addr._id %>" value="<%= addr.State %>">
                        </div>
                        <div class="col-md-6 mb-3">
                          <label class="form-label">Mobile</label>
                          <input type="number" class="form-control" id="reci-Mobile-<%= addr._id %>" value="<%= addr.Mobile %>">
                        </div>
                      </div>
                    </form>
                  </div>
                  <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="updateAddress('<%= addr._id %>','<%= userData._id %>')">Save Changes</button>
                  </div>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </div>
</div>

<!-- Add Address Modal -->
<div class="modal fade" id="addAddressModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-bold">Add New Address</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" class="form-control" id="recipient-name">
          </div>
          <div class="mb-3">
            <label class="form-label">Address</label>
            <textarea class="form-control" id="recipient-address"></textarea>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">City</label>
              <input type="text" class="form-control" id="recipient-City">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Pincode</label>
              <input type="number" class="form-control" id="recipient-Pincode">
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">State</label>
              <input type="text" class="form-control" id="recipient-State">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Mobile</label>
              <input type="number" class="form-control" id="recipient-Mobile">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer bg-light">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="saveAddress()">Save Address</button>
      </div>
    </div>
  </div>
</div>

<script src="/htmlExecutable/user/userAddress.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<%- include('../layouts/user/footer') -%>
